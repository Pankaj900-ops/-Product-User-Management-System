<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Product & User Management</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
  <style>
    :root {
      --primary: #7b5cff;
      --secondary: #42e3ff;
      --accent: #ff6f91;
      --bg-gradient-start: #2a003f;
      --bg-gradient-end: #000428;
      --text-light: #f5f5ff;
      --text-dark: #222;
      --error: #ff4c61;
      --success: #4ee44e;
      --input-bg: rgba(255 255 255 / 0.1);
      --input-focus-bg: rgba(255 255 255 / 0.2);
      --card-bg: rgba(255 255 255 / 0.05);
      --border-radius: 12px;
      --shadow: 0 8px 24px rgba(0,0,0,0.3);
      --neutral-light: #e0e0f7;          
      --neutral-dark: #1a1a2e;         
      --highlight: #ffd166;             
      --muted-text: #8c8caa;             
      --hover-overlay: rgba(123, 92, 255, 0.15); 
      --border-light: rgba(255 255 255 / 0.15); 
    }
    
    

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, var(--bg-gradient-start), var(--bg-gradient-end));
      color: var(--text-light);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header {
      background: var(--primary);
      padding: 1.5rem 2rem;
      text-align: center;
      font-size: 2.2rem;
      font-weight: 700;
      color: var(--text-light);
      box-shadow: var(--shadow);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    main.container {
      flex-grow: 1;
      max-width: 1200px;
      margin: 2rem auto 4rem;
      padding: 0 1rem;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 2rem;
    }

    .card {
      background: var(--card-bg);
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      padding: 2rem;
      display: flex;
      flex-direction: column;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .card:hover {
      transform: translateY(-8px);
      box-shadow: 0 12px 36px rgba(0,0,0,0.4);
    }

    h2 {
      margin-top: 0;
      font-weight: 700;
      border-bottom: 3px solid var(--secondary);
      padding-bottom: 0.5rem;
      color: var(--secondary);
      letter-spacing: 1px;
    }

    ul {
      list-style: none;
      margin: 1rem 0 1.5rem;
      padding: 0;
      max-height: 240px;
      overflow-y: auto;
      border: 1px solid rgba(255 255 255 / 0.1);
      border-radius: var(--border-radius);
      background: rgba(0 0 0 / 0.15);
      box-shadow: inset 0 0 5px rgba(255 255 255 / 0.1);
    }

    li {
      padding: 0.75rem 1rem;
      border-bottom: 1px solid rgba(255 255 255 / 0.1);
      font-weight: 500;
      color: var(--text-light);
      display: flex;
      flex-direction: column;
    }

    li:last-child {
      border-bottom: none;
    }

    .price {
      color: var(--accent);
      font-weight: 700;
      margin-top: 0.25rem;
      font-size: 0.95rem;
    }

    form {
      display: flex;
      flex-direction: column;
      gap: 1.25rem;
    }

    .form-group {
      position: relative;
      width: 100%;
    }

    input, textarea {
      width: 100%;
      padding: 1.1rem 1rem 0.4rem;
      border: none;
      border-radius: var(--border-radius);
      background: var(--input-bg);
      color: var(--text-light);
      font-size: 1rem;
      transition: background 0.3s ease;
      resize: vertical;
    }

    input:focus, textarea:focus {
      outline: none;
      background: var(--input-focus-bg);
      box-shadow: 0 0 5px var(--secondary);
    }

    label {
      position: absolute;
      top: 1.1rem;
      left: 1rem;
      color: rgba(255 255 255 / 0.7);
      font-weight: 600;
      font-size: 1rem;
      pointer-events: none;
      transition: all 0.3s ease;
      user-select: none;
    }

    input:focus + label,
    input:not(:placeholder-shown) + label,
    textarea:focus + label,
    textarea:not(:placeholder-shown) + label {
      top: 0.3rem;
      left: 1rem;
      font-size: 0.75rem;
      color: var(--secondary);
      font-weight: 700;
    }

    button {
      background: linear-gradient(135deg, var(--secondary), var(--accent));
      border: none;
      border-radius: 30px;
      padding: 0.85rem 2rem;
      font-weight: 700;
      font-size: 1.1rem;
      color: var(--text-dark);
      cursor: pointer;
      box-shadow: 0 6px 15px rgba(0,0,0,0.2);
      transition: all 0.3s ease;
      align-self: flex-start;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(0,0,0,0.35);
    }

    .error, .success {
      font-weight: 600;
      margin-top: 0.5rem;
      min-height: 1.4em;
      user-select: none;
    }

    .error {
      color: var(--error);
    }

    .success {
      color: var(--success);
    }

    footer {
      text-align: center;
      padding: 1.5rem 1rem;
      background: var(--primary);
      color: var(--text-light);
      font-size: 0.9rem;
      letter-spacing: 0.5px;
    }

    @media (max-width: 480px) {
      header {
        font-size: 1.5rem;
      }
      main.container {
        padding: 0 0.5rem;
      }
    }
  </style>
</head>
<body>
  <header>üõçÔ∏è Product & User Management System</header>

  <main class="container">
    <!-- Products Section -->
    <section class="card" aria-label="Products Section">
      <h2>Products</h2>
      <ul id="product-list" aria-live="polite" aria-relevant="additions"></ul>
      <h3>Add New Product</h3>
      <form id="product-form" novalidate>
        <div class="form-group">
          <input type="text" id="product-name" placeholder=" " required aria-required="true" />
          <label for="product-name">Name</label>
        </div>

        <div class="form-group">
          <textarea id="product-description" rows="3" placeholder=" " required aria-required="true"></textarea>
          <label for="product-description">Description</label>
        </div>

        <div class="form-group">
          <input type="number" id="product-price" min="0" step="0.01" placeholder=" " required aria-required="true" />
          <label for="product-price">Price ($)</label>
        </div>

        <button type="submit" aria-label="Add Product">Add Product</button>
        <div class="error" id="product-error" role="alert" aria-live="assertive"></div>
        <div class="success" id="product-success" role="alert" aria-live="polite"></div>
      </form>
    </section>

    <!-- Users Section -->
    <section class="card" aria-label="Users Section">
      <h2>Users</h2>
      <ul id="user-list" aria-live="polite" aria-relevant="additions"></ul>
      <h3>Add New User</h3>
      <form id="user-form" novalidate>
        <div class="form-group">
          <input type="text" id="user-username" placeholder=" " required aria-required="true" />
          <label for="user-username">Username</label>
        </div>

        <div class="form-group">
          <input type="email" id="user-email" placeholder=" " required aria-required="true" />
          <label for="user-email">Email</label>
        </div>

        <div class="form-group">
          <input type="text" id="user-mobile" placeholder=" " required aria-required="true" />
          <label for="user-mobile">Mobile No</label>
        </div>

        <button type="submit" aria-label="Add User">Add User</button>
        <div class="error" id="user-error" role="alert" aria-live="assertive"></div>
        <div class="success" id="user-success" role="alert" aria-live="polite"></div>
      </form>
    </section>
  </main>

  <footer>&copy; 2025 Product Management App. All rights reserved.</footer>

  <script>
    function getCookie(name) {
      let cookieValue = null;
      if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let cookie of cookies) {
          cookie = cookie.trim();
          if (cookie.startsWith(name + '=')) {
            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
            break;
          }
        }
      }
      return cookieValue;
    }
    const csrftoken = getCookie('csrftoken');

    const apiBase = '/api';

    const productListEl = document.getElementById('product-list');
    const productForm = document.getElementById('product-form');
    const productErrorEl = document.getElementById('product-error');
    const productSuccessEl = document.getElementById('product-success');

    const userListEl = document.getElementById('user-list');
    const userForm = document.getElementById('user-form');
    const userErrorEl = document.getElementById('user-error');
    const userSuccessEl = document.getElementById('user-success');

    async function loadProducts() {
      productListEl.textContent = 'Loading products...';
      productErrorEl.textContent = '';
      try {
        const res = await fetch(`${apiBase}/products/`);
        if (!res.ok) throw new Error(`Failed to load products (Status: ${res.status})`);
        const products = await res.json();

        if (!Array.isArray(products) || products.length === 0) {
          productListEl.innerHTML = '<li>No products available.</li>';
          return;
        }

        productListEl.innerHTML = '';
        products.forEach(({ name, description, price }) => {
          // Parse price safely (in case it's string)
          const numPrice = parseFloat(price);
          const priceDisplay = isNaN(numPrice) ? 'N/A' : `$${numPrice.toFixed(2)}`;
          const li = document.createElement('li');
          li.innerHTML = `
            <strong>${name}</strong>
            <span class="price">${priceDisplay}</span>
            <p>${description}</p>`;
          productListEl.appendChild(li);
        });
      } catch (error) {
        productListEl.innerHTML = `<li class="error">Error: ${error.message}</li>`;
      }
    }

    async function loadUsers() {
      userListEl.textContent = 'Loading users...';
      userErrorEl.textContent = '';
      try {
        const res = await fetch(`${apiBase}/users/`);
        if (!res.ok) throw new Error(`Failed to load users (Status: ${res.status})`);
        const users = await res.json();

        if (!Array.isArray(users) || users.length === 0) {
          userListEl.innerHTML = '<li>No users available.</li>';
          return;
        }

        userListEl.innerHTML = '';
        users.forEach(({ username, email, mobile_no }) => {
          const li = document.createElement('li');
          li.textContent = `${username} (${email}, ${mobile_no})`;
          userListEl.appendChild(li);
        });
      } catch (error) {
        userListEl.innerHTML = `<li class="error">Error: ${error.message}</li>`;
      }
    }

    async function postData(url = '', data = {}) {
      const response = await fetch(url, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRFToken': csrftoken
        },
        body: JSON.stringify(data)
      });
      if (!response.ok) {
        const errorData = await response.json().catch(() => ({}));
        const msg = errorData.detail || response.statusText || 'Unknown error';
        throw new Error(msg);
      }
      return response.json();
    }

    productForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      productErrorEl.textContent = '';
      productSuccessEl.textContent = '';

      const name = productForm['product-name'].value.trim();
      const description = productForm['product-description'].value.trim();
      const price = parseFloat(productForm['product-price'].value);

      if (!name || !description || isNaN(price) || price < 0) {
        productErrorEl.textContent = 'Please fill all fields correctly.';
        return;
      }

      try {
        await postData(`${apiBase}/products/`, { name, description, price });
        productSuccessEl.textContent = 'Product added successfully!';
        productForm.reset();
        loadProducts();
      } catch (error) {
        productErrorEl.textContent = `Failed to add product: ${error.message}`;
      }
    });

    userForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      userErrorEl.textContent = '';
      userSuccessEl.textContent = '';

      const username = userForm['user-username'].value.trim();
      const email = userForm['user-email'].value.trim();
      const mobile_no = userForm['user-mobile'].value.trim();

      if (!username || !email || !mobile_no) {
        userErrorEl.textContent = 'Please fill all fields.';
        return;
      }

      try {
        await postData(`${apiBase}/users/`, { username, email, mobile_no });
        userSuccessEl.textContent = 'User added successfully!';
        userForm.reset();
        loadUsers();
      } catch (error) {
        userErrorEl.textContent = `Failed to add user: ${error.message}`;
      }
    });

    window.addEventListener('DOMContentLoaded', () => {
      loadProducts();
      loadUsers();
    });
  </script>
</body>
</html>
